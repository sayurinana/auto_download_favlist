# 现在的任务

之前已经完成了一个爬虫程序用于爬取Bilibili用户收藏夹，在`src/auto_download_favlist`下，用法如：

```
PYTHONPATH=src uv run python -m auto_download_favlist.cli "<favlist_url>" -e utf-8 -o favlist.csv
```

现在需要编写点新的模块来扩展功能，具体如下：

- 以CLI形式运行，直接运行启动程序，通过交互式输入获取用户输入，命名为`bilibili_favlist_download_helper`
- 用户可选择录入新收藏夹信息或使用已存档数据中的收藏夹信息，
- 选择录入：
  - 提示用户输入收藏夹URL，在本次开发中使用`https://space.bilibili.com/234561771/favlist?fid=3546830971`作为测试数据，此URL有效
  - 提示用户输入要把视频下载到本地的哪个目录，
  - 然后使用此时的时间戳，用`yyyy-MM-ddThh-mm-ss-favlist.csv`作为输出的收藏夹csv文件名，调用`auto_download_favlist`把收藏夹信息抓取下来，csv保存到用户数据目录中，
  - 把前面的URL、本地目录路径、csv文件名，保存为一条配置信息供以后运行时选用
- 选择使用存档的信息：
  - 从配置中读取以前录入的信息，
  - 然后可以选择是需要编辑还是检查缺漏、检查更新，
  - 编辑则一项项重新输出配置信息，提示是否输入新数据，直接回车则为保持旧数据不变，
    - 因为一般就只有本地目录路径有可能会变更，所以第一条先提示更新路径，其他的放后面，不更新就在输入完路径之后直接留空即可
  - 如果是检查更新，则调用一次`auto_download_favlist`获取最新的收藏夹数据，调用之前把旧的csv做个备份（把.csv变为.backup.csv），然后对比新旧数据，输出新增的条目，对每一个条目的BVid调用`bbdown <bvid>  --work-dir <本地目录路径> `来下载，
  - 如果是检查缺漏，则检索本地目录中的所有文件名，每个文件名中至少含有一个bvid字段（例如`模拟示波器的极炫表演，本作品斩获Revision 2025大赛Wild单元冠军及观众最喜爱奖-[720P 高清][1280x720][30.000fps][HEVC][545kbps]-[M4A][111kbps]-[BV1UDGCznEDS]-by[硬汉嵌入式][678329477][2025-04-29_14-03-25].mp4`中就含有BV号`BV1UDGCznEDS`），把所有视频文件列个表存到一个文件中，便于后续对比，然后检查csv文件中的bv_id列，是否每个id都有其对应的视频文件，对于缺少的，对每一个条目的BVid调用`bbdown <bvid>  --work-dir <本地目录路径> `来下载，

注意:

1. 本次开发中无须实际调用bbdown工具命令，因为当前环境没配置bbdown，不可用，可在程序配置中加入一个--dry-run开关，
2. 重要！：直至开发完成前无须询问用户，遇到问题自行选择解决方案，优化此任务描述后和完成程序设计与流程图png输出后，都不需要询问用户，自行推进，直至完成测试、收尾，再向用户报告，