# 规范守则 - 企业级平台与服务

## 项目类型
- 多业务域共享平台、企业内部PaaS、后台管理/计费/身份系统、跨团队协作微服务集群
- 交付形态：多仓库/单仓库、工作区、模块化微服务、事件驱动系统

## 治理与合规原则
- 建立架构决策记录(ADR)，关键决策需列明背景、备选方案、影响面。
- 采用分层治理：企业级规范（安全、日志、发布策略）→业务域约定→服务级约束。
- 使用[OWASP ASVS](https://owasp.org/www-project-application-security-verification-standard/) Level 2+评估Web/API安全控制，纳入安全评审。
- 将服务清单、数据分类分级、RTO/RPO目标纳入平台总览，便于审计与灾备演练。

## 体系架构要求
- 统一身份与权限：采用OAuth2/OIDC + RBAC/ABAC模型，集中管理Token颁发与刷新。
- 服务通信统一协议与契约：gRPC/REST + OpenAPI/AsyncAPI，版本化并自动生成SDK。
- 数据一致性策略：事务型（2PC/Saga）、事件驱动（Outbox、Change Data Capture）搭配幂等设计。
- 共享组件通过内置包仓库（如Artifactory、GitLab Package Registry）发布，避免多仓库复制粘贴。
## 运维与SRE实践
- 依据[SRE Eliminating Toil](https://sre.google/workbook/eliminating-toil/)度量运行团队工作量，建立自动化目标与燃尽。
- 统一日志、指标、追踪：导出至OpenTelemetry Collector，规定字段（trace_id、user_id、tenant_id等）。
- 设置多层SLO与Error Budget，触发熔断或变更冻结流程。
- 建立混沌演练与灾备演练制度，确保跨区域故障时具备故障转移方案。

## 发布与变更管理
- 所有服务采用GitOps/Argo CD或Spinnaker执行流水线，合并前需通过安全扫描、合契约测试。
- 实施四色环境（dev/test/stage/prod）或蓝绿/金丝雀部署，并记录一次性变更脚本。
- 配置策略即代码(OPA/Gatekeeper)限制基础设施与服务的敏感更改。
- 通过架构委员会审批重大变更，记录风控评估与回滚计划。

## 合规与审计
- 构建权限审计仪表盘，记录谁在何时访问了何种资源。
- 对日志、审计、账务数据保存期符合当地法规，采用WORM存储或对象锁。
- 定期执行渗透测试与安全扫描，形成整改闭环。

## 参考资料
- [OWASP Application Security Verification Standard](https://owasp.org/www-project-application-security-verification-standard/) - 企业级安全控制清单。
- [Microservices on AWS](https://docs.aws.amazon.com/whitepapers/latest/microservices-on-aws/microservices-on-aws.html) - 微服务平台架构、监控、部署实践。
- [OpenTelemetry Python Instrumentation](https://opentelemetry.io/docs/languages/python/instrumentation/) - 企业级统一可观测性实施指南。
- [Google SRE Workbook: Eliminating Toil](https://sre.google/workbook/eliminating-toil/) - 变更与运维效率提升方法论。
